系统设计

- 在 java 里手动实现一个生产者、消费者模型 
- 设计一个视频上传的流程。表设计？文件上传服务器的原理？cdn？高qps怎么处理？上传和请求？缓存怎么加？ 
- 反羊毛怎么做？ 
- 设计一个简单的智能家具系统，比如说加湿器和温湿度传感器关联，怎么设计？考虑哪些点？ 
- 设计一个登陆过程。md5 的原理？可逆么？

### 如何开展一个项目

1）设计背景使用STAR法则，系统的背景、讨论细节点的情景，以及所要达到的目标，解决了哪些具体的问题，并使用分析框架来进行分析，以及要展开设计的难点以及亮点。

2）技术选型上，应该使用表格来对比，并且阐述业界中常用的技术方案的对比。

3）项目带来的对于个人以及团队的收益，设计的不足，以及规划。

4）在PPT中应体现团队对于这个项目的一个团队记录以及分工等。

阿里技术面必胜大法:1.狂背八股文，这步最吃苦像背课文那样,对面会迟疑,起码能过一面。2.二面大概率不是你本专业的,狂吹项目,越夸张最好，把水搅浑让他懵逼3.三面对面职级很高，谨慎吹逼，低调为主4如果有四面，价值观为主，热爱加班，公司我家。以上仅适用非算法类技术，p7以下。

### 单点登录

用户请求A，A查session没查到登录状态，重定向到SSO。SSO查session没查到登录状态。

用户登录，将token存到session（key：log in）

用户再次请求A或B系统，重定向到SSO，通过session拿到token，后将token转发到A系统，A系统向SSO验证，成功后将token存到局部session（key：log in），后通过拦截。下一次再访问，查局部session，有则表明已登录。

### 微信小程序登录流程

jwt

JWT实际上只是一个规范，一个Token的规范。符合JWT规范的Token可以用于Authorization (授权)。

用户首次登录，服务器会为其生成一个token，并返回给客户端。客户端接收到之后，存储下来，之后每次请求的请求头都会包含token。服务器收到请求，就会验证客户端发送过来的token。验证通过，就响应请求，否则就提示用户登录失效。

**符合JWT规范的token可以用于登录授权的原因是：**

- 当JWT的任一部分被修改的时候：服务器对前面两个部分进行签名，就会发现两次签名不一致
- 那么 refresh token 换取 access token 每 24h 只要一次就好了，也就是说每天只有这一次的机会会泄漏 refresh token
  而 access token 则会在每一次调用中都可能泄漏，泄漏几率远大于 refresh token

### 令牌桶和漏桶区别

比如网络中使用令牌桶，光纤网络可以承受 10Gbps 的速度，但是因为你宽带套餐只给了 100Mbps，所以用令牌来限制你长期使用网络的速度。如果只是临时传个文件，就可以短期突破限制。如果是长期占用，就限制住。

又比如，如果网络是根烂网线，只能承受 100Mbps，然后你又选了 100Mbps 的套餐，那就得用漏桶来限制输入速度，否则输入太快会被网卡丢弃掉。

如果你要互相类比的话，令牌桶是允许爆发流出，而漏桶是允许爆发流入。

滑动窗口：将时间分为单位个小格子，确定start和end，取sum，若大于，则限流

## 服务熔断

当下游的服务因为某种原因突然变得不可用或响应过慢，上游服务为了保证自己整体服务的可用性，不再继续调用目标服务，直接返回，快速释放资源。

## 服务限流

服务限流常见算法有并发计数器算法，漏桶算法，令牌桶算法。前两种算法不支持突发流量的限流，令牌桶算法支持突发流量的限流。…一般用谷歌 guava 落地令牌桶算法

## 服务降级

调用一个接口一定时间内多次超时或者是多次返回异常，就会触发降级策略，调用降级方法

## 服务隔离

每个服务接口之间互不影响

#### 秒杀系统的设计

限流层

服务层：限流后并发量几百：redis减库存-》丢到消息队列-》写入订单。

几万-》本地缓存有：锁+减本地缓存-》redis缓存有：减redis缓存-》丢到消息队列-》写入订单。

## 订阅binlog：camel







