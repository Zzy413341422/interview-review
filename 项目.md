系统设计

- 一天爬一千万条文章，怎么做设计？怎么并行协调？100 台服务器怎么尽可能负载均衡？ 
- 怎么设计一个秒杀系统？怎么解决大并发？ 
- 设计一个抢红包系统，要注意哪些点 
- 设计一个微博社交系统，怎么更高效，索引怎么设计、提高效率，查询扫描行数，缓存设计 
- 在 java 里手动实现一个生产者、消费者模型 
- 设计一个视频上传的流程。表设计？文件上传服务器的原理？cdn？高qps怎么处理？上传和请求？缓存怎么加？ 
- 有什么分布式 id 生成方法？各自的优缺点是什么？ 
- 反羊毛怎么做？ 
- 设计一个简单的智能家具系统，比如说加湿器和温湿度传感器关联，怎么设计？考虑哪些点？ 
- 设计一个登陆过程。md5 的原理？可逆么？

### 如何开展一个项目

1）设计背景使用STAR法则，系统的背景、讨论细节点的情景，以及所要达到的目标，解决了哪些具体的问题，并使用分析框架来进行分析，以及要展开设计的难点以及亮点。

2）技术选型上，应该使用表格来对比，并且阐述业界中常用的技术方案的对比。

3）项目带来的对于个人以及团队的收益，设计的不足，以及规划。

4）在PPT中应体现团队对于这个项目的一个团队记录以及分工等。



### 微信小程序登录流程

jwt

JWT实际上只是一个规范，一个Token的规范。符合JWT规范的Token可以用于Authorization (授权)。

用户首次登录，服务器会为其生成一个token，并返回给客户端。客户端接收到之后，存储下来，之后每次请求的请求头都会包含token。服务器收到请求，就会验证客户端发送过来的token。验证通过，就响应请求，否则就提示用户登录失效。

**符合JWT规范的token可以用于登录授权的原因是：**

- 当JWT的任一部分被修改的时候：服务器对前面两个部分进行签名，就会发现两次签名不一致
- 那么 refresh token 换取 access token 每 24h 只要一次就好了，也就是说每天只有这一次的机会会泄漏 refresh token
  而 access token 则会在每一次调用中都可能泄漏，泄漏几率远大于 refresh token

### 单点登录

用户请求A，A查session没查到登录状态，重定向到SSO。SSO查session没查到登录状态。

用户登录，将token存到session（key：log in）

用户再次请求A或B系统，重定向到SSO，通过session拿到token，后将token转发到A系统，A系统向SSO验证，成功后将token存到局部session（key：log in），后通过拦截。下一次再访问，查局部session，有则表明已登录。

## 服务熔断

当下游的服务因为某种原因突然变得不可用或响应过慢，上游服务为了保证自己整体服务的可用性，不再继续调用目标服务，直接返回，快速释放资源。

## 服务限流

服务限流常见算法有并发计数器算法，漏桶算法，令牌桶算法。前两种算法不支持突发流量的限流，令牌桶算法支持突发流量的限流。…一般用谷歌 guava 落地令牌桶算法

## 服务降级

这个场景在双十一就能看到,为了保证秒杀，购物，支付等业务正常进行，会禁用一些服务，降低图片的清晰度等等。

## 服务隔离

每个服务接口之间互不影响

![](\md\88.png)

#### 秒杀系统的设计

从渲染秒杀数据->下单防超卖整个过程中基本会涉及以下几个问题活动预算控制，个人预算控制，热点数据解决，流量限流，数据缓存方案1.渲染静态数据cdn缓存，动态数据多级缓存，避免流量通往DB，造成雪崩2.库存用redis做原子计算，个人预算通过用户key缓存redis检验3.热点数据提前缓存，梳理秒杀数据涉及表结构数据4.根据算法将大部分无限流量抛弃5.库存更新做乐观锁防止超卖6.逆向过程中，库存回补7.数据一致性监控......



可以用redis的链表来实现，假如这个商品有100件，可以事先往链表里面写入100个元素。当用户来下单的时候，可以把该商品所对应的缓存数据进行挨个删除，因为redis的链表的增删是具有原子性的，每次只能进行一次操作。当秒杀结束时，把缓存中的订单信息取出来，更新到mysql中就行。







